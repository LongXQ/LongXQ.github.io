<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> fcntl ioctl setsockopt使用说明 · oooo</title><meta name="description" content="fcntl ioctl setsockopt使用说明 - 龙雄球"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://longxq.github.io/atom.xml" title="oooo"></head><body><div class="wrap"><header><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/LongXQ" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xm" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">fcntl ioctl setsockopt使用说明</h1><div class="post-info">Jul 7, 2018</div><div class="post-content"><p>写程序的时候经常搞不清fcntl，ioctl和setsockopt的区别，而且其中每一个函数的参数也是这么多，所以作下笔记给以后写程序的时候参考参考。<br>我们都知道Linux(unix)中所有的东西都是文件，Linux把大部分东西都虚拟成了一个文件，也就是平常我们写程序一般都是基于在VFS(虚拟文件系统)之上的。通过VFS和硬件打交道。  </p>
<p><img src="/images/VFS.png" alt="VFS模型"></p>
<a id="more"></a>
<h3 id="fcntl函数"><a href="#fcntl函数" class="headerlink" title="fcntl函数"></a>fcntl函数</h3><p>fcntl函数作用在VFS层，它控制文件系统的一些参数，如文件访描述符标志，文件状态标志等。<br> <strong>F_GETFD</strong><br>读取文件描述符标志<br> <strong>F_SETFD</strong><br>设置文件描述符标志<br>现阶段指支持这一个标志:FD_CLOEXEC(close-on-<br>exec)，这个标志的作用是在执行exec的时候在子进程中关闭设置了FD_CLOEXEC的fd，这个标志也可以在open函数在打开一个文件的时候使用O_CLOEXEC。<br> <strong>F_GETFL</strong><br>读取文件访问权限和文件状态标志。<br> <strong>F_SETFL</strong><br>虽然F_GETFL能够读取到文件的访问权限，但是不能用fcntl设置他们。<br><strong>O_APPEND</strong> 设置文件追加到文件末尾标志<br><strong>O_ASYNC</strong> 当文件能够读或者写的时候可以发送信号(SIGIO)。这个特性仅仅对终端，伪终端，sockets和pipes和FIFOs有用。<br><strong>O_DIRECT</strong> 直接从设备中读写<br><strong>O_NOATIME</strong> 不更新文件最后一次访问时间(inode中的st_atime属性)<br><strong>O_NONBLOCK</strong> 设置文件为非阻塞标志</p>
<h3 id="ioctl函数"><a href="#ioctl函数" class="headerlink" title="ioctl函数"></a>ioctl函数</h3><p>ioctl则是直接控制一些IO设备的一些属性，对设备的一些特性进行控制。如终端设备的波特率这些。ioctl和设备关系密切，所以再次就不一一列举控制参数了。一个fd能够被ioctl操作前提是fd对应的设备在驱动程序中实现了ioctl函数。</p>
<h3 id="setsockopt函数"><a href="#setsockopt函数" class="headerlink" title="setsockopt函数"></a>setsockopt函数</h3><p>setsockopt函数则是专门控制socket的一些参数。它指定了在不同的level上面设置参数。<br><strong>SOL_SOCKET</strong> sockets API level<br>SO_KEEPALIVE设置TCP的keep alive选项，去探测失效的一端<br>SO_SNDBUF设置发送buffer<br>SO_SNDTIMEO、SO_RCVTIMEO发送或者接收超时时间，直到一个错误产生。<br>SO_REUSEADDR重用地址端口。当一个端口关闭时，这个socket处于TIME_WAIT状态，假如我们在新建一个socket，但是又绑定处于TIME-<br>WAIT状态的端口，则会出错，但是如果设置了这个选项，则不会出错了。<br>SO_BROADCAST<br>设置broadcast标志。UDP socket能够发送数据给broadcast地址，对TCP socket无效。<br>SO_ERROR<br>得到和清除pending socket error。<br>SO_RCVBUF<br>设置或得到socket接收buffer<br> <strong>IPPROTO_TCP</strong><br>TCP_KEEPIDLE<br>如果在设置的时间内没有响应则发送心跳包检测<br>TCP_KEEPINTVL<br>设置发送心跳包的时间间隔<br>TCP_KEEPCNT<br>设置发送心跳包的次数<br>TCP_NODELAY<br>禁用TCP协议中的Nagle算法</p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/07/07/redisevent/" class="prev">PREV</a><a href="/2018/07/07/redisdb/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'longxq-github-io';
var disqus_identifier = '2018/07/07/fcntl/';
var disqus_title = 'fcntl ioctl setsockopt使用说明';
var disqus_url = 'https://longxq.github.io/2018/07/07/fcntl/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//longxq-github-io.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2018 <a href="https://longxq.github.io">龙雄球</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>